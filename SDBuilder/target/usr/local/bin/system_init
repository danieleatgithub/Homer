#!/bin/bash

. /etc/system.conf

MACADDRESS=$(/usr/local/bin/get_mac)
if [[ $? -ne 0 ]];then
	logger "system_init failed reading mac"
	exit 1
fi
INTERFACES="/etc/network/interfaces"
cp /usr/local/share/interfaces.template $INTERFACES
sed -i.bak s/__MACADDRESS__/$MACADDRESS/ $INTERFACES
sed -i.bak s/__IPADDRESS__/$MNG_IP/ $INTERFACES
sed -i.bak s/__NETMASK__/255.255.255.0/ $INTERFACES

rm $INTERFACES.bak

# Setting hostname
echo $NAME > /etc/hostname
echo "Welcome to $NAME" > /etc/issue
sed -i.bak s/__NAME__/$NAME/ /etc/hosts

# Remove first start job
rm /etc/init.d/S00systeminit
