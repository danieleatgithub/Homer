#!/bin/bash
################################################
#
# Read mac address from i2c and write for the DHCP
# request
#
################################################

MACADDRESS=$(/usr/local/bin/get_mac)
if [[ $? -ne 0 ]];then
	logger "system_init failed reading mac"
	exit 1
fi
INTERFACES="/etc/network/interfaces"
sed -i "s/#_TAG_MAC_ADDRESS/	hwaddress ether $MACADDRESS/" $INTERFACES
logger "SYSINIT MACADDRESS FIXED"

# Update data filesystem
mkdir /data/logs

# ======== PATCH FIXME: Only for debug ==========
touch /data/logs/hdevice.txt
touch /data/logs/homerd.txt
chmod -R 777 /data
ln -s /data /var/www/data 
chmod -R 777 /var/www/data
#====== PATCH END =========


#====== PATCH buildroot 2016.11 ============
if [[ $(vim --version | grep IMproved | awk '{print $5}') == "8.0" ]];then
   logger "SYSINIT PATCH VIM 8.0 APPLIED"
   sed -i s/Purple/Magenta/g /usr/share/vim/vim80/syntax/syncolor.vim
   sed -i s/SlateBlue/LightBlue/g /usr/share/vim/vim80/syntax/syncolor.vim
fi
#====== PATCH END =========



# Remove first start job
rm /etc/init.d/S00systeminit
